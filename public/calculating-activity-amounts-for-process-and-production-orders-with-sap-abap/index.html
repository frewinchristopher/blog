<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.625 -apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}h1{margin-left:0;margin-right:0;margin-top:2.4375rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.21875rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);}h2{margin-left:0;margin-right:0;margin-top:1.625rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.40625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:hsla(0,0%,0%,0.53);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}ul{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:0.85rem;line-height:1.625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:1rem;line-height:1.625rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:calc(0.8125rem - 1px);padding-right:0;padding-top:0;margin-bottom:0.8125rem;border-left:4px solid hsla(0,0%,0%,0.13);color:hsla(0,0%,0%,0.53);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(0.8125rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}b{font-weight:600;}strong{font-weight:600;}dt{font-weight:600;}th{font-weight:600;}li{margin-bottom:calc(0.8125rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}li > ul{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(0.8125rem / 2);}code{font-size:0.85rem;line-height:1.625rem;}kbd{font-size:0.85rem;line-height:1.625rem;}samp{font-size:0.85rem;line-height:1.625rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.08333rem;padding-right:1.08333rem;padding-top:0.8125rem;padding-bottom:calc(0.8125rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}h3,h4,h5,h6{margin-bottom:0.8125rem;margin-top:1.625rem;}ol,ul{margin-left:2.03125rem;}li>ol,li>ul{margin-left:2.03125rem;}a{color:#4078c0;text-decoration:none;}a:hover,a:active{text-decoration:underline;}</style><meta data-react-helmet="true" name="description" content="Edit June 1st, 2018: There was ANOTHER issue with this code! There is something you need to add if you want to book custom goods movements for the retrograde…"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#000000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><title data-react-helmet="true">Calculating Activity Amounts for Production and Process Orders with SAP ABAP | Chris&#x27; Full Stack Blog</title><meta name="generator" content="Gatsby 2.18.12"/><meta data-react-helmet="true" property="og:title" content="Calculating Activity Amounts for Production and Process Orders with SAP ABAP"/><meta data-react-helmet="true" property="og:description" content="Edit June 1st, 2018: There was ANOTHER issue with this code! There is something you need to add if you want to book custom goods movements for the retrograde…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Chris Frewin"/><meta data-react-helmet="true" name="twitter:title" content="Calculating Activity Amounts for Production and Process Orders with SAP ABAP"/><meta data-react-helmet="true" name="twitter:description" content="Edit June 1st, 2018: There was ANOTHER issue with this code! There is something you need to add if you want to book custom goods movements for the retrograde…"/><style data-href="/styles.2a9f61eda99a67b070b5.css">@import url(https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@600&display=swap);@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;text-shadow:0 1px #fff}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}.token.punctuation{color:#999}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.switch-container{text-align:center;display:flex;flex-wrap:wrap;justify-content:center;margin:1rem}.switch-text{flex-basis:100%;font-size:.5rem;text-transform:uppercase;margin:.25rem;font-weight:700}.switch{position:relative;text-align:center;display:inline-block;width:50px;height:27px}.switch input{opacity:0;width:0;height:0}.slider{cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#fff}.slider,.slider:before{position:absolute;-webkit-transition:.4s;transition:.4s}.slider:before{content:"";height:19px;width:20px;left:4px;bottom:4px}.slider:before,input:checked+.slider{background-color:#000}input:checked+.slider:before{background-color:#fff}input:focus+.slider{box-shadow:0 0 1px #000}input:checked+.slider:before{-webkit-transform:translateX(22px);transform:translateX(22px)}.slider.round{border-radius:27px}.slider.round:before{border-radius:50%}body,html{font-family:Nunito Sans,sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-transition:color 1s;transition:color 1s;-webkit-transition:background-color 1s;transition:background-color 1s}body .dark-mode,html .dark-mode{background-color:#272822;color:#fff}body .light-mode,html .light-mode{background-color:#fff;color:#272822}h1{border-bottom:none}header{z-index:20;position:relative}footer{margin-top:6rem}footer,main{position:relative;z-index:10}a{color:#f92672}a,input,label{z-index:10}.twentytwenty-fun{display:inline-block;position:relative;font-size:.75rem;font-family:Courier New,Courier,monospace;-webkit-animation:hover 2s ease-in-out infinite alternate;animation:hover 2s ease-in-out infinite alternate;line-height:.75rem;text-align:center}@-webkit-keyframes hover{0%{-webkit-transform:translateY(-10%);transform:translateY(-10%);-webkit-transform:translateX(-10%);transform:translateX(-10%);-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:translateY(10%);transform:translateY(10%);-webkit-transform:translateX(10%);transform:translateX(10%);-webkit-transform:rotate(30deg);transform:rotate(30deg)}}@keyframes hover{0%{-webkit-transform:translateY(-10%);transform:translateY(-10%);-webkit-transform:translateX(-10%);transform:translateX(-10%);-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:translateY(10%);transform:translateY(10%);-webkit-transform:translateX(10%);transform:translateX(10%);-webkit-transform:rotate(30deg);transform:rotate(30deg)}}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-2642abeb110b544c12ef.js"/><link as="script" rel="preload" href="/commons-7d19cfac33a62ab090eb.js"/><link as="script" rel="preload" href="/app-4c82f1120542748bc39c.js"/><link as="script" rel="preload" href="/styles-5d031bf83756cf4dd9d4.js"/><link as="script" rel="preload" href="/webpack-runtime-36e88acb22a2e2ba2636.js"/><link as="fetch" rel="preload" href="/page-data/calculating-activity-amounts-for-process-and-production-orders-with-sap-abap/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:39rem;padding:2.4375rem 1.21875rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Chris&#x27; Full Stack Blog</a></h3><div class="switch-container"><label class="switch"><input type="checkbox"/><span class="slider round"></span></label><span class="switch-text"><b>Dark<!-- --> mode active</b></span></div></header><main><article><header><h1 style="margin-top:1.625rem;margin-bottom:0">Calculating Activity Amounts for Production and Process Orders with SAP ABAP</h1><p style="font-size:0.87055rem;line-height:1.625rem;display:block;margin-bottom:1.625rem">January 03, 2018</p></header><section><p><em>Edit June 1st, 2018:</em></p>
<p><em>There was ANOTHER issue with this code! There is something you need to add if you want to book custom goods movements for the retrograde materials. You can see how to do this in <a href="#footnote-6">footnote 6</a> for more.</em></p>
<p><em>Edit April 19th, 2018:</em></p>
<p><em>There was a bug with this code! When we make the conversion to MIN, we forgot to overwrite</em> <code class="language-text">lv_unit</code> <em>to</em> <code class="language-text">MIN</code><em>, so the conversion was correct, but the unit was left in hours, or</em> <code class="language-text">H</code> <em>! You can see this in the code comments with date 2018.04.19.</em></p>
<h1>First off, Congratulations! 🎊</h1>
<p><sup>And a happy new year! (If you’re viewing this in the summer or something, see the date! 😉)</sup></p>
<h2>You’ve found the only post on the entire internet that describes the full process of calculating activity amounts for production order confirmations by programming it directly using SAP ABAP! 😱😱😱</h2>
<h2>I hope you use this post to maximum effectiveness, because it took me <em>four</em> days to find, build, and get a working answer. 😄</h2>
<h2>The Problem</h2>
<p>Let’s jump right into ABAP programming: the go-to function module to calculate time ticket proposals for production orders is with function module <code class="language-text">BAPI_PRODORDCONF_GET_TT_PROP</code>:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PRODORDCONF_GET_TT_PROP'</span>
<span class="token comment">* EXPORTING</span>
<span class="token comment">*   PROPOSE                  = ' '</span>
<span class="token comment">* IMPORTING</span>
<span class="token comment">*   RETURN                   =</span>
  <span class="token keyword">TABLES</span>
    timetickets              <span class="token operator">=</span>
<span class="token comment">*   GOODSMOVEMENTS           =</span>
<span class="token comment">*   LINK_CONF_GOODSMOV       =</span>
<span class="token comment">*   DETAIL_RETURN            =</span>
          <span class="token punctuation">.</span></code></pre></div>
<p>Likewise, there is a very similiar <code class="language-text">BAPI_PROCORDCONF_GET_TT_PROP</code> for process orders:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PROCORDCONF_GET_TT_PROP'</span>
<span class="token comment">* EXPORTING</span>
<span class="token comment">*   PROPOSE                  = ' '</span>
<span class="token comment">* IMPORTING</span>
<span class="token comment">*   RETURN                   =</span>
  <span class="token keyword">TABLES</span>
    timetickets              <span class="token operator">=</span>
<span class="token comment">*   GOODSMOVEMENTS           =</span>
<span class="token comment">*   LINK_CONF_GOODSMOV       =</span>
<span class="token comment">*   DETAIL_RETURN            =</span>
          <span class="token punctuation">.</span></code></pre></div>
<p>Pretty similar. However, as part of my indentured servitude that is being a full-time employee, I spent a day tinkering, writing, and testing code with these function modules. No matter what combinations of inputs I provided, I couldn’t get the <em>activity confirmation amount</em> to be calculated, which are a very important part of the final calculation of the confirmation! (more on the actual final confirmation submission is also included in later on) From scrounging around on SCN and the SAP blog, I learned that many developers had the same issue with these functions. (Things like date, yield/scrap amounts, and the goods movements would be proposed just fine by these BAPIs.)</p>
<p>So, <strong>calculating these activity confirmation amounts programmatically (in ABAP) will be the main focus of this post <sup><a href="#footnote-1">1</a></sup>.</strong></p>
<p>Unfortunately, with much more digging, the reason the two functions wouldn’t produce activity confirmation amounts never became quite clear to me. I realized I would have to calculate them in a more manual manner and then add them to those BAPI structures <code class="language-text">lt_timetickets</code> manually.</p>
<h2>The Calculation Function Module</h2>
<p>Through SAP GUI in transaction <code class="language-text">CO11N</code>, determining system-proposed confirmation amounts is easy enough by and asking the system to do the calculation for us <sup><a href="#footnote-2">2</a></sup>. My struggle was finding the programmatic way to do this in ABAP.</p>
<p>Anyone with significant production planning experience (i.e., not me 😂 ) knows that the actual formula behind the activity calculation is not with the activity itself, but with the work center <em>behind</em> the activity <sup><a href="#footnote-3">3</a></sup>.</p>
<p>In transaction <code class="language-text">CR03</code> (display work center), in the ‘Costing’ Tab, there is a ‘Formula’ button with the check symbol on it:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 417px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/be1d226058c78f355eb1b74fb4aaad43/f01c2/test-formula.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 25.899280575539567%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdyiUH//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAEAAwEAAAAAAAAAAAAAAAABABBhEf/aAAgBAQABPyFNZzWv/9oADAMBAAIAAwAAABD/AP8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAEDGBwf/aAAgBAQABPxAjCFuYdq//2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="GUI testing calculation"
        title="GUI testing calculation"
        src="/static/be1d226058c78f355eb1b74fb4aaad43/f01c2/test-formula.jpg"
        srcset="/static/be1d226058c78f355eb1b74fb4aaad43/7237a/test-formula.jpg 148w,
/static/be1d226058c78f355eb1b74fb4aaad43/0cfdf/test-formula.jpg 295w,
/static/be1d226058c78f355eb1b74fb4aaad43/f01c2/test-formula.jpg 417w"
        sizes="(max-width: 417px) 100vw, 417px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>This was my starting point to find any sort of function that could do this programmatically - with more time, I learned from SCN of a function that does exactly that! It’s called <code class="language-text">CR_WORKCENTER_FORMULA_CALC</code>!</p>
<p>Let’s head on over to transaction <code class="language-text">SE37</code> and test it ourselves!</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 434px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fbfdd9c4bd38fad10e79caffb36fef90/78156/error-test-frame.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.71889400921659%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgH/2gAMAwEAAhADEAAAAdkUwBf/xAAYEAADAQEAAAAAAAAAAAAAAAAAAhMDEv/aAAgBAQABBQKSEkOMz//EABYRAAMAAAAAAAAAAAAAAAAAAAABEv/aAAgBAwEBPwGUQj//xAAXEQADAQAAAAAAAAAAAAAAAAAAARES/9oACAECAQE/AazbP//EABcQAAMBAAAAAAAAAAAAAAAAAAABMjH/2gAIAQEABj8CwlEo/8QAFhABAQEAAAAAAAAAAAAAAAAAAPFh/9oACAEBAAE/IcqcmP/aAAwDAQACAAMAAAAQdC//xAAXEQEBAQEAAAAAAAAAAAAAAAABADFh/9oACAEDAQE/EOJCmX//xAAXEQEBAQEAAAAAAAAAAAAAAAABADFh/9oACAECAQE/EO0m7f/EABoQAQABBQAAAAAAAAAAAAAAAAEAESExceH/2gAIAQEAAT8QeOQEy7gBQttGP//Z'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Yep, that&#39;s SAP"
        title="Yep, that&#39;s SAP"
        src="/static/fbfdd9c4bd38fad10e79caffb36fef90/78156/error-test-frame.jpg"
        srcset="/static/fbfdd9c4bd38fad10e79caffb36fef90/7237a/error-test-frame.jpg 148w,
/static/fbfdd9c4bd38fad10e79caffb36fef90/0cfdf/error-test-frame.jpg 295w,
/static/fbfdd9c4bd38fad10e79caffb36fef90/78156/error-test-frame.jpg 434w"
        sizes="(max-width: 434px) 100vw, 434px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>😑😑😑 shit… SAP, you had one job to do!</p>
<p>Fine. We’ll do it ourselves. We can open up the source code of <code class="language-text">CR_WORKCENTER_FORMULA_CALC</code> and set a breakpoint in the first line:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7f2c794c579923ae724605626ba5369b/6248e/function-breakpoint.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 61.25954198473282%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3UlEQVQoz32T7ZqaMBCFvZFu67qQT8I3ggKCguhufbb3fzOnkyjtul37Y0ggyZtzZoaFlBJBEEAqBcMk2lWAlGmsNxWiKAJjDEKIu+Cc//NtjoV9mNBAaoXIl6h9A6E0NF1g15jgYASwEAufYY+gCylIoQmgCKC4wG6zxTAOqKrKqQ59gZAc6EAjjmMYY8Bn1V9A/yi0QMYZ9uOIy+XNARQTeH0yGMotjpefeP/1jl3fw/+f5Y8KrY2maXCcjmjaBhEpG38EqNMC212LlkJpDf4AdlMonQ1FObQ56voO59cz+n2PQ9dj/K6xSXK8+D5Wz89gNF7tfhF3QHUF7roO02nCdD6ha1scvyl0eYWkyJGvC0RZSvv4tVgUvvg7tw4Xrm0+WN7WNcZhwOntjFQb7J8IWG3de5UXyIMYmvaF1GI2YuoMc5s7heyuKBz1rsFEhweye1hqHJISx/Pk8pd4AuVKIaUzpaew9jTalwAFzUufepncLjJK/KxQUx4KaVCYGGkUIw9jZGTTtpAJQ1ddX9q+FM6qDe82+rPlPk6gKYfzn7JZSuRLjjTLsC7XyPMcZVk6oOd5twrzx0XxiGpuCg21REaAtCxQUBGSJHZAYdfo0jRNEbDrYT5DP7XNb6Y2ckfFq7IrAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="The first possible line in the function we can breakpoint"
        title="The first possible line in the function we can breakpoint"
        src="/static/7f2c794c579923ae724605626ba5369b/799d3/function-breakpoint.png"
        srcset="/static/7f2c794c579923ae724605626ba5369b/00d96/function-breakpoint.png 148w,
/static/7f2c794c579923ae724605626ba5369b/0b23c/function-breakpoint.png 295w,
/static/7f2c794c579923ae724605626ba5369b/799d3/function-breakpoint.png 590w,
/static/7f2c794c579923ae724605626ba5369b/2a3d6/function-breakpoint.png 885w,
/static/7f2c794c579923ae724605626ba5369b/6248e/function-breakpoint.png 1048w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>and in CR03, drag our <a href="https://chrisfrew.in/debugging-abap-with-sap-shortcut">debugging shortcut into the calculation window</a>, and we press return SAP debugging’s return button to jump out to whatever parent program is calling this function… <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 58px;">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVQ4y82US08TURiG+xfcudUfoSs36m9wRyK6UFBjEBZYiyKXIGINgQjaYAoIhVohloiFchNihFBooTPcWlpQrhFpKZQWIsnjmTGtCEMToiYu3pzrPOf9vvnO0W24J/mb0h2cCI9OJNv9/T8HjsiiL/+cV+DHAf5yIiAuL6HhcTalAJGxGQGWjgXV7XcW8fqJziyxs7CJ/Pg+wd5uMV5UoQrsoLQO0SWcRcZ9rHR2MVmah6+yDOf509jPnSTY16M63RgWTkUaVLmUdiIJPQQMiTC3Z1fxPszGefkC7oZq2i+ewn7mBJ/dQ+xEosRW14h9XVcV/xYmOr8k0iNrh5wASgU5eARsNwbuwhxWBvqwvLKSdjWdzFs3uZZxnYwbmaRdSee5sZxdOcD6iJwa6KoqYVMOirAkYuN+ht+2Y31m4r2tla7ubrqcThydHbj7P7LlmTpUUr8DRciexhdshfcIB5YJ+b4QHZuG4CrO5jfcvpNFnsFAVnY2DdUmdqRZQkc69K8gF+XSceksgyU59Oem46ksJjzmIyL2eHoHsLW00Ga3Y2ttYdDZox4W0nKo2haLa/2fmKutYc5sIlhTxaLttZqj7dFJHI1W7hruUVxUhF64tL6sJS75tR0m61CUx9b0giql/iJSkHhgAaK7SEMuzLVmmpuaqKuv58M7B9ti/9EOE/dXKWKhdZGGuNdHm8WKviCfsqdGyisqVD0yPqGtyUpMrIdG5dR3OSEllLhIuqPOQrHegDG/kNI8AX5QQGGunlaTOXXIWlIcx8RHe9PzfJ+aS0oZx+VZzVdIlwqmOhUhKT/moBLONOvwnz6w/x3wB7cgXYFtrqWrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="return" title="return" src="/static/00b1c8c77e113cd8f5a0809a202489c2/a4d99/return.png" srcset="/static/00b1c8c77e113cd8f5a0809a202489c2/a4d99/return.png 58w" sizes="(max-width: 58px) 100vw, 58px" loading="lazy">
    </span> and…</p>
<p>🙏 Violá! 🙏 We’ve found where <code class="language-text">CR_WORKCENTER_FORMULA_CALC</code> is called out in the wild!</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/264ed624475401f4e4bc06397a03d9b9/fe80b/function-found.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 80.1670146137787%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACX0lEQVQ4y3VU7XKbMBDkUTqNQUhIAgGSMTY2ECdtp53EHk/c5v0fZHuSsZ04yY+dgxlub/c+iLTSkEpCaw2lFEWF2uSYa4MyL5DnmpCDMRbAOUeapuAe9HyLyBN5Qk/GWEpRYlg2+GM7bOYtBJHVzqLrOpR1fSX9hOwDYSo4dCrQlBZN32HZrbBol8hJsVeaZRklfa7srDw6W5ZShqoZ43BxBs0zMCrAMwFGHyYJC/AubuGJ0qkFkVd2ggSj6oZl+PFdYzXT6O4k2m8CpRLoNgWGsSQYDIPBcqkx3hdoW01QqKoskL9TGKR7NUQ8J5XrmcJWO6yKGpkUZJlDkGr/rIucSEqYyqBpXGjJB8uXCZ4j2V1v1jDGXGx5MC6gKovt9h7zpiHiKmxCIDxb9qQfCClxGIdL9bMDJgRy68jyiA0VDEWm6QeFgfAThX5I99strczqksAnhca5UOzh8ZFIu68JecrDcCz1sIsVxtzCCnXdu6lQRjnGFAFhQ26nfLZ8SSBiRTs5rDcYNz22Dw9hE1J/MaSwcNS70mA2i9+5uhLeWPYqE+rVeuzRLtswGEHvfrE9YdW0cLZ+f46nS7lROMGrMymtznyBWueYxfHpnpMECSXntcVisYCk60nf3HUk3/QwZf4iEsQEc5didZdh1Ba9cTBkz9EgmmZOp+jVMkgen67HF5kQleZq2d+136mKfgKmrqhPFj9//wrY7XbhB9GSKtssKNZYObrxokRJBcyEyNUyNNvL7fsex+MRh5cXHP/+o3jE6+srDocD9vs9np+f8fT0FKJ/3+93odBb/Adm0PJiqmZfeAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="There you are `CR_WORKCENTER_FORMULA_CALC`"
        title="There you are `CR_WORKCENTER_FORMULA_CALC`"
        src="/static/264ed624475401f4e4bc06397a03d9b9/799d3/function-found.png"
        srcset="/static/264ed624475401f4e4bc06397a03d9b9/00d96/function-found.png 148w,
/static/264ed624475401f4e4bc06397a03d9b9/0b23c/function-found.png 295w,
/static/264ed624475401f4e4bc06397a03d9b9/799d3/function-found.png 590w,
/static/264ed624475401f4e4bc06397a03d9b9/2a3d6/function-found.png 885w,
/static/264ed624475401f4e4bc06397a03d9b9/fe80b/function-found.png 958w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>(For those deeply interested, you can find exactly where the function is called in SAP Program <code class="language-text">SAPLCRA0</code>, Include <code class="language-text">LCRA0F71</code>, line 55, at least for SAPGUI 740.)</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1d2cbb852e085c74901d5a542ef48c3a/b7c40/form-program.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 12.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArUlEQVQI12WOTQ6CMBQGuf+BXKgbXKCiFRGJlZZWICb+QEEvMNaoKxeTvMVkvhfUSYYRKXdZ0usTTlkGXfG0DQ9TexqGquGqSqz33u7toL/uP0E8miAjwSVTdAdDW1jOmaSI1tjVjnKRYDcZx1ggxiF6ueWaa9zR0nq/+/K7gzycM6iavvgstP7DU7onmc6QC8E+jHxcYGIfXqe4XNHuJHeP8+PvsJOWThp6VfECz7nV6JHw8hkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Calling program details"
        title="Calling program details"
        src="/static/1d2cbb852e085c74901d5a542ef48c3a/799d3/form-program.png"
        srcset="/static/1d2cbb852e085c74901d5a542ef48c3a/00d96/form-program.png 148w,
/static/1d2cbb852e085c74901d5a542ef48c3a/0b23c/form-program.png 295w,
/static/1d2cbb852e085c74901d5a542ef48c3a/799d3/form-program.png 590w,
/static/1d2cbb852e085c74901d5a542ef48c3a/2a3d6/form-program.png 885w,
/static/1d2cbb852e085c74901d5a542ef48c3a/b7c40/form-program.png 960w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>The Details (The Hard Part)</h2>
<p>So what the heck does SAP do with this function? Well, first, they are doing a do loop six times. Aha, we know why - because there can be a total of six confirmation values <sup><a href="#footnote-4">4</a></sup>  - SAP is by default looping over all of them.</p>
<p>Now for the function parameters themselves: they pass the work center code (<code class="language-text">arbid</code>), the operation number (<code class="language-text">rcrop</code>), the index of the confirmation (a value of 1-6), our 4 default values (<code class="language-text">vgw</code>), and the date (<code class="language-text">date</code>).</p>
<p>In turn, the function spits out the fixed value amount of the activity calculation (<code class="language-text">value_fix</code>), the variable part (<code class="language-text">value_var</code>), both in whatever unit the function gives out in <code class="language-text">unit</code>, and <code class="language-text">co_a</code> is for the cost center accounting <sup><a href="#footnote-5">5</a></sup>. There are actually four exceptions to this function, so I’m not sure why SAP internal is taking only two of them. In any case, there are other <code class="language-text">IMPORTING</code> and <code class="language-text">EXPORTING</code> parameters in the function signature, but this looks like a good starting point as a minimum. In fact, as you’ll see below, the final working version of the code I created is almost exactly the same except where I found out with a bit of playing around.</p>
<p>So I mentioned the default values that must go into <code class="language-text">vgw</code> - these are the four values that are the equivalent of those four fields we can type into in <code class="language-text">COR3</code> for checking the formula, things like setup time, machine time, personnel setup, and personnel time. It might sound like a lot of work to hunt down these values, but luckily these are master data and can be determined with a few select statements, first from table <code class="language-text">AFVC</code> ‘operation within an order’, and then table <code class="language-text">PLPO</code> ‘task list - operation/activity’:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token eol-comment comment">" this is the full key for table AFVC - operation within an order - for the routing number and counter - should always work with SELECT SINGLE</span>
<span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> afvc <span class="token keyword">INTO</span> ls_afvc
  <span class="token keyword">WHERE</span> aufpl <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>routing_no
  <span class="token keyword">AND</span>   aplzl <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>counter<span class="token punctuation">.</span>

<span class="token eol-comment comment">" this is the full key for table PLPO - task list - operation/activity - so it should always work with SELECT SINGLE</span>
<span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> plpo <span class="token keyword">INTO</span> ls_plpo
  <span class="token keyword">WHERE</span> plnty <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnty
  <span class="token keyword">AND</span> plnnr <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnnr
  <span class="token keyword">AND</span> plnkn <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnkn
  <span class="token keyword">AND</span> zaehl <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>zaehl<span class="token punctuation">.</span></code></pre></div>
<p>The routing number <code class="language-text">ls_operation-routing_no</code> and counter <code class="language-text">ls_operation-counter</code> we’ve gotten from function <code class="language-text">BAPI_PRODORD_GET_DETAIL</code>:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token eol-comment comment">" need only the operations from the function</span>
    ls_order_objects<span class="token token-operator punctuation">-</span>operations <span class="token operator">=</span> <span class="token string">'X'</span><span class="token punctuation">.</span>
    lv_number <span class="token operator">=</span> ls_orderid_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>

    <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PRODORD_GET_DETAIL'</span>
      <span class="token keyword">EXPORTING</span>
        <span class="token keyword">number</span>        <span class="token operator">=</span> lv_number
<span class="token comment">*       COLLECTIVE_ORDER       =</span>
        order_objects <span class="token operator">=</span> ls_order_objects
<span class="token comment">*     IMPORTING</span>
<span class="token comment">*       RETURN        =</span>
      <span class="token keyword">TABLES</span>
<span class="token comment">*       HEADER        =</span>
<span class="token comment">*       POSITION      =</span>
<span class="token comment">*       SEQUENCE      =</span>
        operation     <span class="token operator">=</span> lt_operation
<span class="token comment">*       TRIGGER_POINT =</span>
<span class="token comment">*       COMPONENT     =</span>
<span class="token comment">*       PROD_REL_TOOL =</span>
      <span class="token punctuation">.</span></code></pre></div>
<p>(There is plenty of SAP standard documentation and discussion on SCN on how to use <code class="language-text">BAPI_PRODORD_GET_DETAIL</code>, so I’ll leave that to you if you need more info 😉. Here we are just getting the operation information from the order - that’s all we need.)</p>
<p>We can finally move the corresponding fields of <code class="language-text">ls_plpo</code> to <code class="language-text">ls_vgw</code>:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">MOVE-CORRESPONDING</span> ls_plpo <span class="token keyword">TO</span> ls_vgw<span class="token punctuation">.</span></code></pre></div>
<p>However, in addition to these four values, there are two more that are essential, that is the yield amount (<code class="language-text">mgvrg</code>), and the unit (<code class="language-text">meinh</code>)! We can pass them right into <code class="language-text">ls_op</code> as well:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">MOVE-CORRESPONDING</span> ls_plpo <span class="token keyword">TO</span> ls_op<span class="token punctuation">.</span>
ls_op<span class="token token-operator punctuation">-</span>mgvrg <span class="token operator">=</span> ls_yield_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
ls_op<span class="token token-operator punctuation">-</span>meinh <span class="token operator">=</span> ls_conf_quan_unit_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span></code></pre></div>
<p>Armed with our structures <code class="language-text">ls_afvc</code>, <code class="language-text">ls_op</code>, and <code class="language-text">ls_vgw</code>, we are ready to call our function:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'CR_WORKCENTER_FORMULA_CALC'</span> <span class="token eol-comment comment">" You can see a SAP standard example with the function in the source code for transaction CR03 for costing formula: Program SAPLCRA0, Include LCRA0F71, Form FORMEL_RESULT_CALC, line 55</span>
  <span class="token keyword">EXPORTING</span>
    arbid             <span class="token operator">=</span> ls_afvc<span class="token token-operator punctuation">-</span>arbid
    op                <span class="token operator">=</span> ls_op
    vgw               <span class="token operator">=</span> ls_vgw
    <span class="token keyword">index</span>             <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>index
    <span class="token keyword">date</span>              <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datum
  <span class="token keyword">IMPORTING</span>
    value_fix          <span class="token operator">=</span> lv_value_fix
    value_var         <span class="token operator">=</span> lv_value_var
    <span class="token keyword">unit</span>              <span class="token operator">=</span> lv_unit
  <span class="token keyword">EXCEPTIONS</span>
    missing_parameter <span class="token operator">=</span> <span class="token number">1</span>
    not_found         <span class="token operator">=</span> <span class="token number">2</span>
    division_by_zero  <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">OTHERS</span>            <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">.</span>
<span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
  <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
  <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
<span class="token keyword">ENDIF</span><span class="token punctuation">.</span></code></pre></div>
<p>We want the total, right? Okay, we just add the fixed value and variable value part:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap">lv_value <span class="token operator">=</span> lv_value_fix <span class="token operator">+</span> lv_value_var<span class="token punctuation">.</span> <span class="token eol-comment comment">" total value is the sum of the fixed and variable values for this activity</span></code></pre></div>
<p>A requirement by my company was to have all the activity confirmation values with the same unit (I find it cleaner anyway to have all the activity confirmation values in the same unit anyway). Unfortunately, the default unit for some of the activities was hours, so we have to take a small intermediary step and call a conversion function before we are truly done:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token eol-comment comment">" convert any </span><span class="token string">'H'</span> <span class="token keyword">values</span> <span class="token keyword">to</span> <span class="token string">'MIN'</span>
<span class="token keyword">IF</span> lv_unit <span class="token keyword">NE</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
  <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'UNIT_CONVERSION_SIMPLE'</span>
    <span class="token keyword">EXPORTING</span>
      <span class="token keyword">input</span>                <span class="token operator">=</span> lv_value
      unit_in              <span class="token operator">=</span> lv_unit
      unit_out             <span class="token operator">=</span> <span class="token string">'MIN'</span>
    <span class="token keyword">IMPORTING</span>
      <span class="token keyword">output</span>               <span class="token operator">=</span> lv_output
    <span class="token keyword">EXCEPTIONS</span>
      conversion_not_found <span class="token operator">=</span> <span class="token number">1</span>
      division_by_zero     <span class="token operator">=</span> <span class="token number">2</span>
      input_invalid        <span class="token operator">=</span> <span class="token number">3</span>
      output_invalid       <span class="token operator">=</span> <span class="token number">4</span>
      <span class="token keyword">overflow</span>              <span class="token operator">=</span> <span class="token number">5</span>
      type_invalid         <span class="token operator">=</span> <span class="token number">6</span>
      units_missing        <span class="token operator">=</span> <span class="token number">7</span>
      unit_in_not_found    <span class="token operator">=</span> <span class="token number">8</span>
      unit_out_not_found   <span class="token operator">=</span> <span class="token number">9</span>
      <span class="token keyword">OTHERS</span>               <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>
  <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
    lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
    <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
    <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
  <span class="token keyword">ENDIF</span><span class="token punctuation">.</span></code></pre></div>
<p>We then finally carry over this converted <code class="language-text">lv_output</code> over to the <code class="language-text">conf_activity</code> field for <code class="language-text">lt_timetickets</code>, doing this for all 1-6 <code class="language-text">conf_activity</code>’s:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">CASE</span> sy<span class="token token-operator punctuation">-</span>index<span class="token punctuation">.</span>
  <span class="token keyword">WHEN</span> <span class="token number">1</span><span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity1  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit1 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
  <span class="token keyword">WHEN</span> <span class="token number">2</span><span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity2  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit2 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
  <span class="token keyword">WHEN</span> <span class="token number">3</span><span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity3  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit3 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
  <span class="token keyword">WHEN</span> <span class="token number">4</span><span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity4  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit4 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
  <span class="token keyword">WHEN</span> <span class="token number">5</span><span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity5  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit5 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
  <span class="token keyword">WHEN</span> <span class="token number">6</span><span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity6  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit6 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
<span class="token keyword">ENDCASE</span><span class="token punctuation">.</span></code></pre></div>
<p>With that, we can call the final confirmation function, with all our calculated values wrapped up in <code class="language-text">lt_timetickets</code>:</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token eol-comment comment">" create confirmation</span>
<span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PRODORDCONF_CREATE_TT'</span>
<span class="token comment">*     EXPORTING</span>
<span class="token comment">*       POST_WRONG_ENTRIES             = '0'</span>
<span class="token comment">*       TESTRUN                        =</span>
<span class="token comment">*       CALL_ON_INBOUND_QUEUE          = ' '</span>
  <span class="token keyword">IMPORTING</span>
    <span class="token keyword">return</span>         <span class="token operator">=</span> ls_return
  <span class="token keyword">TABLES</span>
    timetickets    <span class="token operator">=</span> lt_timetickets
    goodsmovements <span class="token operator">=</span> lt_goodsmovements
<span class="token comment">*       LINK_CONF_GOODSMOV             =</span>
<span class="token comment">*       CHARACTERISTICS_WIPBATCH       =</span>
<span class="token comment">*       LINK_CONF_CHAR_WIPBATCH        =</span>
    detail_return  <span class="token operator">=</span> lt_detail_return
<span class="token comment">*       CHARACTERISTICS_BATCH          =</span>
<span class="token comment">*       LINK_GM_CHAR_BATCH             =</span>
  <span class="token keyword">EXCEPTIONS</span>
    <span class="token keyword">OTHERS</span>         <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>
<span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
  lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
  <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
  <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
<span class="token keyword">ENDIF</span><span class="token punctuation">.</span></code></pre></div>
<p>If you were sharp, you realized all of this code is only on the operation level - so indeed, the six-level loop must be done each time, for each operation - we have to throw all the above code into a loop over our operations! See below for the full result!</p>
<h2>Production Orders</h2>
<p>In summary, the full code looks like this:</p>
<p><strong>NOTE: the full code examples were written for a SAP Gateway environment - i.e. the server environment from a SAPUI5 OData call! If you try to copy and paste this code directly into something like a report or function, ABAP statements like:</strong></p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap">lt_filters <span class="token operator">=</span> io_tech_request_context<span class="token token-operator punctuation">-></span>get_filter<span class="token punctuation">(</span> <span class="token punctuation">)</span>->get_filter_select_options<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre></div>
<p>won’t be in scope and won’t compile without errors! However, if you are familiar with the CRUD based methods of the SAP Gateway backend, these will fit nicely into the <code class="language-text">GET_ENTITYSET</code> method 😄</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap"><span class="token keyword">DATA</span> <span class="token punctuation">:</span> lt_filters           <span class="token keyword">TYPE</span>           /iwbep/t_mgw_select_option<span class="token punctuation">,</span>
           ls_filters           <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_filters<span class="token punctuation">,</span>
           lt_select_options    <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_plant_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_orderid_so        <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_fin_conf_so       <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_dev_reason_so     <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_conf_text_so      <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_conf_quan_unit_so <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_yield_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           ls_scrap_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
           lt_stg_loc           <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_stg_loc           <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_stg_loc<span class="token punctuation">,</span>
           lt_batch             <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_batch             <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_batch<span class="token punctuation">,</span>
           lt_reserv_no         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_reserv_no         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_reserv_no<span class="token punctuation">,</span>
           lt_res_item          <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_res_item          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_res_item<span class="token punctuation">,</span>
           lt_entry_qnt         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_entry_qnt         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_entry_qnt<span class="token punctuation">,</span>
           lt_entry_uom         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
           ls_entry_uom         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_entry_uom<span class="token punctuation">,</span>
           ls_return            <span class="token keyword">TYPE</span> bapiret1<span class="token punctuation">,</span>
           lt_goodsmovements    <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi2017_gm_item_create<span class="token punctuation">,</span>
           ls_goodsmovements    <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_goodsmovements<span class="token punctuation">,</span>
           lv_reserv_lines      <span class="token keyword">TYPE</span> int4<span class="token punctuation">,</span>
           lv_index             <span class="token keyword">TYPE</span> int4 <span class="token keyword">VALUE</span> <span class="token number">1</span><span class="token punctuation">,</span>
           lt_detail_return     <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi_coru_return<span class="token punctuation">,</span>
           ls_detail_return     <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_detail_return<span class="token punctuation">,</span>
           lv_log_handle        <span class="token keyword">TYPE</span> balloghndl<span class="token punctuation">,</span>
           lv_message           <span class="token keyword">TYPE</span> char200<span class="token punctuation">,</span>
           lo_logger            <span class="token keyword">TYPE</span> <span class="token keyword">REF</span> <span class="token keyword">TO</span> zcl_bc_app_logger<span class="token punctuation">,</span>
           es_entityset         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> et_entityset<span class="token punctuation">,</span>
           lv_error_message     <span class="token keyword">TYPE</span> bapi_msg<span class="token punctuation">,</span>
           ls_order_objects     <span class="token keyword">TYPE</span> bapi_pp_order_objects<span class="token punctuation">,</span>
           lt_operation         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi_order_operation1<span class="token punctuation">,</span>
           ls_operation         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_operation<span class="token punctuation">,</span>
           lt_timetickets       <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  bapi_pp_timeticket<span class="token punctuation">,</span>
           ls_timetickets       <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_timetickets<span class="token punctuation">,</span>
           lv_number            <span class="token keyword">TYPE</span> bapi_order_key<span class="token token-operator punctuation">-</span>order_number<span class="token punctuation">,</span>
           ls_propose           <span class="token keyword">TYPE</span> bapi_pp_conf_prop<span class="token punctuation">,</span>
           ls_op                <span class="token keyword">TYPE</span> rcrop<span class="token punctuation">,</span>
           ls_vgw               <span class="token keyword">TYPE</span> rcrvgw<span class="token punctuation">,</span>
           ls_afvc              <span class="token keyword">TYPE</span> afvc<span class="token punctuation">,</span>
           ls_plpo              <span class="token keyword">TYPE</span> plpo<span class="token punctuation">,</span>
           lv_value_fix         <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">4</span><span class="token punctuation">,</span>
           lv_value_var         <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">4</span><span class="token punctuation">,</span>
           lv_value             <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">4</span><span class="token punctuation">,</span>
           lv_unit              <span class="token keyword">TYPE</span> rcrvgw<span class="token token-operator punctuation">-</span>vge01<span class="token punctuation">,</span>
           lv_output            <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">3</span><span class="token punctuation">.</span>

           <span class="token eol-comment comment">" Create a log instance</span>
    <span class="token keyword">CREATE</span> <span class="token keyword">OBJECT</span> lo_logger
      <span class="token keyword">EXPORTING</span>
        iv_subobject <span class="token operator">=</span> <span class="token string">'ZPP_APP'</span><span class="token punctuation">.</span>
    lo_logger<span class="token token-operator punctuation">-></span>create_log<span class="token punctuation">(</span> <span class="token keyword">IMPORTING</span> ev_log_handle <span class="token operator">=</span> lv_log_handle <span class="token punctuation">)</span><span class="token punctuation">.</span>
    lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">'Begin Method PRODCONFIRMATION_GET_ENTITYSET.'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>

    <span class="token eol-comment comment">"get $filter through the io_tech request (odata request)</span>
    lt_filters <span class="token operator">=</span> io_tech_request_context<span class="token token-operator punctuation">-></span>get_filter<span class="token punctuation">(</span> <span class="token punctuation">)</span>->get_filter_select_options<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>

    <span class="token eol-comment comment">" Process filters</span>

    <span class="token eol-comment comment">" for these below we just need the singular select option structure</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'PLANT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_plant_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'ORDERID'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_orderid_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'FIN_CONF'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_fin_conf_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'DEV_REASON'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_dev_reason_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'CONF_TEXT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_conf_text_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'CONF_QUAN_UNIT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_conf_quan_unit_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'YIELD'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_yield_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'SCRAP'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_scrap_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

    <span class="token eol-comment comment">" for the following we need tables (make a loop and get the values from each)</span>
    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'STGE_LOC'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_stg_loc <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'BATCH'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_batch <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'RESERV_NO'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_reserv_no <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'RES_ITEM'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_res_item <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'ENTRY_QNT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_entry_qnt <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

    <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
    <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'ENTRY_UOM'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
    lt_entry_uom <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

<span class="token eol-comment comment">" Create goodsmovement structure for all the retroactive items</span>
    <span class="token keyword">DESCRIBE</span> <span class="token keyword">TABLE</span> lt_reserv_no <span class="token keyword">LINES</span> lv_reserv_lines<span class="token punctuation">.</span>
    <span class="token keyword">DO</span> lv_reserv_lines <span class="token keyword">TIMES</span><span class="token punctuation">.</span>
      ls_stg_loc <span class="token operator">=</span> lt_stg_loc[ lv_index ]<span class="token punctuation">.</span>
      ls_batch <span class="token operator">=</span> lt_batch[ lv_index ]<span class="token punctuation">.</span>
      ls_reserv_no <span class="token operator">=</span> lt_reserv_no[ lv_index ]<span class="token punctuation">.</span>
      ls_res_item <span class="token operator">=</span> lt_res_item[ lv_index ]<span class="token punctuation">.</span>
      ls_entry_qnt <span class="token operator">=</span> lt_entry_qnt[ lv_index ]<span class="token punctuation">.</span>
      ls_entry_uom <span class="token operator">=</span> lt_entry_uom[ lv_index ]<span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>plant <span class="token operator">=</span> ls_plant_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span> <span class="token eol-comment comment">" fixed factory</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>stge_loc <span class="token operator">=</span> ls_stg_loc<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>batch <span class="token operator">=</span> ls_batch<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>move_type <span class="token operator">=</span> <span class="token string">'261'</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" fixed movement type</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>item_text <span class="token operator">=</span> <span class="token string">'Warenbewegung für Rückmeldung PP APP'</span><span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>reserv_no <span class="token operator">=</span> ls_reserv_no<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>res_item <span class="token operator">=</span> ls_res_item<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>entry_qnt <span class="token operator">=</span> ls_entry_qnt<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_goodsmovements<span class="token token-operator punctuation">-</span>entry_uom <span class="token operator">=</span> ls_entry_uom<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      <span class="token keyword">APPEND</span> ls_goodsmovements <span class="token keyword">TO</span> lt_goodsmovements<span class="token punctuation">.</span>
      lv_index <span class="token operator">=</span> lv_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span>
    <span class="token keyword">ENDDO</span><span class="token punctuation">.</span>

    <span class="token eol-comment comment">" need only the operations from the function</span>
    ls_order_objects<span class="token token-operator punctuation">-</span>operations <span class="token operator">=</span> <span class="token string">'X'</span><span class="token punctuation">.</span>
    lv_number <span class="token operator">=</span> ls_orderid_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>

    <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PRODORD_GET_DETAIL'</span>
      <span class="token keyword">EXPORTING</span>
        <span class="token keyword">number</span>        <span class="token operator">=</span> lv_number
<span class="token comment">*       COLLECTIVE_ORDER       =</span>
        order_objects <span class="token operator">=</span> ls_order_objects
<span class="token comment">*     IMPORTING</span>
<span class="token comment">*       RETURN        =</span>
      <span class="token keyword">TABLES</span>
<span class="token comment">*       HEADER        =</span>
<span class="token comment">*       POSITION      =</span>
<span class="token comment">*       SEQUENCE      =</span>
        operation     <span class="token operator">=</span> lt_operation
<span class="token comment">*       TRIGGER_POINT =</span>
<span class="token comment">*       COMPONENT     =</span>
<span class="token comment">*       PROD_REL_TOOL =</span>
      <span class="token punctuation">.</span>

    <span class="token eol-comment comment">" build structures for each step (each operation)</span>
    <span class="token keyword">LOOP</span> <span class="token keyword">AT</span> lt_operation <span class="token keyword">INTO</span> ls_operation<span class="token punctuation">.</span>
      <span class="token keyword">CLEAR</span> ls_timetickets<span class="token punctuation">.</span>

      <span class="token eol-comment comment">" this is the full key for table AFVC - Auftragsarbeitsvorgang for the routing number and counter - should always work with SELECT SINGLE</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> afvc <span class="token keyword">INTO</span> ls_afvc
        <span class="token keyword">WHERE</span> aufpl <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>routing_no
        <span class="token keyword">AND</span>   aplzl <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>counter<span class="token punctuation">.</span>

      <span class="token eol-comment comment">" this is the full key for table PLPO - Plan: Vorgang - so it should always work with SELECT SINGLE</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> plpo <span class="token keyword">INTO</span> ls_plpo
        <span class="token keyword">WHERE</span> plnty <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnty
        <span class="token keyword">AND</span> plnnr <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnnr
        <span class="token keyword">AND</span> plnkn <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnkn
        <span class="token keyword">AND</span> zaehl <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>zaehl<span class="token punctuation">.</span>

      <span class="token eol-comment comment">" now provide all the standard values (vorgabewert) VGW01, 02, etc into the calculation formula</span>
      <span class="token keyword">MOVE-CORRESPONDING</span> ls_plpo <span class="token keyword">TO</span> ls_op<span class="token punctuation">.</span>
      ls_op<span class="token token-operator punctuation">-</span>mgvrg <span class="token operator">=</span> ls_yield_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_op<span class="token token-operator punctuation">-</span>meinh <span class="token operator">=</span> ls_conf_quan_unit_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      <span class="token keyword">MOVE-CORRESPONDING</span> ls_plpo <span class="token keyword">TO</span> ls_vgw<span class="token punctuation">.</span>
      <span class="token keyword">DO</span> <span class="token number">6</span> <span class="token keyword">TIMES</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" for each activity (usually 4 activities here at my company, but there can be up to 6 activities total)</span>
        <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">1</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw01 <span class="token keyword">EQ</span> <span class="token number">0</span>
        <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">2</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw02 <span class="token keyword">EQ</span> <span class="token number">0</span>
        <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">3</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw03 <span class="token keyword">EQ</span> <span class="token number">0</span>
        <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">4</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw04 <span class="token keyword">EQ</span> 0f
        <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">5</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw05 <span class="token keyword">EQ</span> <span class="token number">0</span>
        <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">6</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw06 <span class="token keyword">EQ</span> <span class="token number">0</span><span class="token punctuation">.</span>
          <span class="token keyword">CONTINUE</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" skip and 0 values</span>
        <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>
        <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'CR_WORKCENTER_FORMULA_CALC'</span> <span class="token eol-comment comment">" You can see a SAP standard example with the function in the source code for transaction CR03 for costing formula: Program SAPLCRA0, Include LCRA0F71, Form FORMEL_RESULT_CALC, line 55</span>
          <span class="token keyword">EXPORTING</span>
            arbid             <span class="token operator">=</span> ls_afvc<span class="token token-operator punctuation">-</span>arbid
            op                <span class="token operator">=</span> ls_op
            vgw               <span class="token operator">=</span> ls_vgw
            <span class="token keyword">index</span>             <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>index
            <span class="token keyword">date</span>              <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datum
          <span class="token keyword">IMPORTING</span>
            value_fix          <span class="token operator">=</span> lv_value_fix
            value_var         <span class="token operator">=</span> lv_value_var
            <span class="token keyword">unit</span>              <span class="token operator">=</span> lv_unit
          <span class="token keyword">EXCEPTIONS</span>
            missing_parameter <span class="token operator">=</span> <span class="token number">1</span>
            not_found         <span class="token operator">=</span> <span class="token number">2</span>
            division_by_zero  <span class="token operator">=</span> <span class="token number">3</span>
            <span class="token keyword">OTHERS</span>            <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">.</span>
        <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
          <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
          <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
        <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>

        lv_value <span class="token operator">=</span> lv_value_fix <span class="token operator">+</span> lv_value_var<span class="token punctuation">.</span> <span class="token eol-comment comment">" total value is the sum of the fixed and varible values for this activity</span>

        <span class="token eol-comment comment">" convert any </span><span class="token string">'H'</span> <span class="token keyword">values</span> <span class="token keyword">to</span> <span class="token string">'MIN'</span>
        <span class="token keyword">IF</span> lv_unit <span class="token keyword">NE</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
          <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'UNIT_CONVERSION_SIMPLE'</span>
            <span class="token keyword">EXPORTING</span>
              <span class="token keyword">input</span>                <span class="token operator">=</span> lv_value
              unit_in              <span class="token operator">=</span> lv_unit
              unit_out             <span class="token operator">=</span> <span class="token string">'MIN'</span>
            <span class="token keyword">IMPORTING</span>
              <span class="token keyword">output</span>               <span class="token operator">=</span> lv_output
            <span class="token keyword">EXCEPTIONS</span>
              conversion_not_found <span class="token operator">=</span> <span class="token number">1</span>
              division_by_zero     <span class="token operator">=</span> <span class="token number">2</span>
              input_invalid        <span class="token operator">=</span> <span class="token number">3</span>
              output_invalid       <span class="token operator">=</span> <span class="token number">4</span>
              <span class="token keyword">overflow</span>              <span class="token operator">=</span> <span class="token number">5</span>
              type_invalid         <span class="token operator">=</span> <span class="token number">6</span>
              units_missing        <span class="token operator">=</span> <span class="token number">7</span>
              unit_in_not_found    <span class="token operator">=</span> <span class="token number">8</span>
              unit_out_not_found   <span class="token operator">=</span> <span class="token number">9</span>
              <span class="token keyword">OTHERS</span>               <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>
          <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
            lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
            <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
            <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
          <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>
          lv_unit <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" 2018.04.19 - need to overwrite unit to MIN!</span>
        <span class="token keyword">ELSE</span><span class="token punctuation">.</span>
          lv_output <span class="token operator">=</span> lv_value<span class="token punctuation">.</span> <span class="token eol-comment comment">" copy over MIN value</span>
        <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>

        <span class="token keyword">CASE</span> sy<span class="token token-operator punctuation">-</span>index<span class="token punctuation">.</span>
          <span class="token keyword">WHEN</span> <span class="token number">1</span><span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity1  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit1 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
          <span class="token keyword">WHEN</span> <span class="token number">2</span><span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity2  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit2 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
          <span class="token keyword">WHEN</span> <span class="token number">3</span><span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity3  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit3 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
          <span class="token keyword">WHEN</span> <span class="token number">4</span><span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity4  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit4 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
          <span class="token keyword">WHEN</span> <span class="token number">5</span><span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity5  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit5 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
          <span class="token keyword">WHEN</span> <span class="token number">6</span><span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity6  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
            ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit6 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">ENDCASE</span><span class="token punctuation">.</span>
      <span class="token keyword">ENDDO</span><span class="token punctuation">.</span>

      <span class="token eol-comment comment">" Now build the table to confirm the operations (Vorgänge)</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>conf_no     <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>conf_no<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>orderid     <span class="token operator">=</span> ls_orderid_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>sequence    <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>sequence_no<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>operation   <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>operation_number<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>work_cntr   <span class="token operator">=</span> ls_operation<span class="token token-operator punctuation">-</span>work_center<span class="token punctuation">.</span> <span class="token eol-comment comment">" Resource for process order, logdate, logtime, and posting date added to the table</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>plant       <span class="token operator">=</span> ls_plant_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>logdate     <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datlo<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>logtime     <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>timlo<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>postg_date  <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datlo<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>yield <span class="token operator">=</span> ls_yield_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>scrap <span class="token operator">=</span> ls_scrap_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>fin_conf <span class="token operator">=</span> ls_fin_conf_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span> <span class="token eol-comment comment">" also overwrite the proposed partial or final confirmation - take what the user provides!</span>
      ls_timetickets<span class="token token-operator punctuation">-</span>conf_quan_unit <span class="token operator">=</span> ls_conf_quan_unit_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span> <span class="token eol-comment comment">" Also the unit</span>
      <span class="token keyword">APPEND</span> ls_timetickets <span class="token keyword">TO</span> lt_timetickets<span class="token punctuation">.</span>
    <span class="token keyword">ENDLOOP</span><span class="token punctuation">.</span>

    <span class="token eol-comment comment">" create confirmation</span>
    <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PRODORDCONF_CREATE_TT'</span>
<span class="token comment">*     EXPORTING</span>
<span class="token comment">*       POST_WRONG_ENTRIES             = '0'</span>
<span class="token comment">*       TESTRUN                        =</span>
<span class="token comment">*       CALL_ON_INBOUND_QUEUE          = ' '</span>
      <span class="token keyword">IMPORTING</span>
        <span class="token keyword">return</span>         <span class="token operator">=</span> ls_return
      <span class="token keyword">TABLES</span>
        timetickets    <span class="token operator">=</span> lt_timetickets
        goodsmovements <span class="token operator">=</span> lt_goodsmovements
<span class="token comment">*       LINK_CONF_GOODSMOV             =</span>
<span class="token comment">*       CHARACTERISTICS_WIPBATCH       =</span>
<span class="token comment">*       LINK_CONF_CHAR_WIPBATCH        =</span>
        detail_return  <span class="token operator">=</span> lt_detail_return
<span class="token comment">*       CHARACTERISTICS_BATCH          =</span>
<span class="token comment">*       LINK_GM_CHAR_BATCH             =</span>
      <span class="token keyword">EXCEPTIONS</span>
        <span class="token keyword">OTHERS</span>         <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>
    <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
      lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
      <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
      <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
    <span class="token keyword">ENDIF</span><span class="token punctuation">.</span></code></pre></div>
<h2>Process Orders</h2>
<p>Because SAP is ever-so-special, process orders have a slightly different program process due to a few name changes. Here is a summary of some of those name and type changes:</p>
<hr/>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Production Orders</th>
<th>Process Orders</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name of the ‘steps’ in your process or production order</td>
<td>phase/activity (I’ve seen both names, ABAP uses mostly ‘phase’)</td>
<td>operation</td>
</tr>
<tr>
<td>Get order detail of order</td>
<td><code class="language-text">BAPI_PRODORD_GET_DETAIL</code></td>
<td><code class="language-text">BAPI_PROCORD_GET_DETAIL</code></td>
</tr>
<tr>
<td>detail of order ‘step’ type</td>
<td><code class="language-text">bapi_order_phase</code></td>
<td><code class="language-text">bapi_order_operation1</code></td>
</tr>
<tr>
<td>Function for timeticket proposals</td>
<td><code class="language-text">BAPI_PRODORD_GET_DETAIL</code></td>
<td><code class="language-text">BAPI_PROCORD_GET_DETAIL</code></td>
</tr>
<tr>
<td>Function for order confirmation</td>
<td><code class="language-text">BAPI_PRODORDCONF_CREATE_TT</code></td>
<td><code class="language-text">BAPI_PROCORDCONF_CREATE_TT</code></td>
</tr>
<tr>
<td><code class="language-text">timetickets</code> <code class="language-text">TYPE</code> in order confirmation function</td>
<td><code class="language-text">bapi_pp_timeticket</code></td>
<td><code class="language-text">bapi_pi_timeticket1</code></td>
</tr>
</tbody>
</table>
<hr/>
<p>There are more, but you can find those in the code for yourself. The important thing to notice is that the key challenging part here, calculating the confirmation activity amounts, uses the same internal function module, <code class="language-text"></code></p>
<p>Here’s the code for calculating activities for process orders - <em>note the slight change in all the variable names!</em> - and be careful with your types (carefully look over the <code class="language-text">DATA:</code> statement), otherwise you’ll get 💥<strong>exploding runtime errors</strong>💥 when you try to confirm something with one of our two main functions and you pass, for example, the  <code class="language-text">lt_timetickets</code> with the production type <code class="language-text"></code>, and you pass it into the of the <em>process</em> order function module.</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap">  <span class="token keyword">DATA</span> <span class="token punctuation">:</span> lt_filters           <span class="token keyword">TYPE</span>           /iwbep/t_mgw_select_option<span class="token punctuation">,</span>
         ls_filters           <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_filters<span class="token punctuation">,</span>
         lt_select_options    <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_plant_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_orderid_so        <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_fin_conf_so       <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_dev_reason_so     <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_conf_text_so      <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_conf_quan_unit_so <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_yield_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_scrap_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_stge_loc_so       <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_batch_so          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_reserv_no_so      <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_res_item_so       <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_entry_qnt_so      <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         ls_entry_uom_so      <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_select_options<span class="token punctuation">,</span>
         lt_stg_loc           <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_stg_loc           <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_stg_loc<span class="token punctuation">,</span>
         lt_batch             <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_batch             <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_batch<span class="token punctuation">,</span>
         lt_reserv_no         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_reserv_no         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_reserv_no<span class="token punctuation">,</span>
         lt_res_item          <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_res_item          <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_res_item<span class="token punctuation">,</span>
         lt_entry_qnt         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_entry_qnt         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_entry_qnt<span class="token punctuation">,</span>
         lt_entry_uom         <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span>  /iwbep/s_cod_select_option<span class="token punctuation">,</span>
         ls_entry_uom         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_entry_uom<span class="token punctuation">,</span>
         ls_return            <span class="token keyword">TYPE</span> bapiret1<span class="token punctuation">,</span>
         lt_goodsmovements    <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi2017_gm_item_create<span class="token punctuation">,</span>
         ls_goodsmovements    <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_goodsmovements<span class="token punctuation">,</span>
         lv_reserv_lines      <span class="token keyword">TYPE</span> int4<span class="token punctuation">,</span>
         lv_index             <span class="token keyword">TYPE</span> int4 <span class="token keyword">VALUE</span> <span class="token number">1</span><span class="token punctuation">,</span>
         lt_detail_return     <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi_coru_return<span class="token punctuation">,</span>
         ls_detail_return     <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_detail_return<span class="token punctuation">,</span>
         lv_log_handle        <span class="token keyword">TYPE</span> balloghndl<span class="token punctuation">,</span>
         lv_message           <span class="token keyword">TYPE</span> char200<span class="token punctuation">,</span>
         lo_logger            <span class="token keyword">TYPE</span> <span class="token keyword">REF</span> <span class="token keyword">TO</span> zcl_bc_app_logger<span class="token punctuation">,</span>
         es_entityset         <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> et_entityset<span class="token punctuation">,</span>
         lv_error_message     <span class="token keyword">TYPE</span> bapi_msg<span class="token punctuation">,</span>
         ls_order_objects     <span class="token keyword">TYPE</span> bapi_pi_order_objects<span class="token punctuation">,</span>
         lt_phase             <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi_order_phase<span class="token punctuation">,</span>
         ls_phase             <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_phase<span class="token punctuation">,</span>
         lt_timetickets       <span class="token keyword">TYPE</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> bapi_pi_timeticket1<span class="token punctuation">,</span>
         ls_timetickets       <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_timetickets<span class="token punctuation">,</span>
         lv_number            <span class="token keyword">TYPE</span> bapi_order_key<span class="token token-operator punctuation">-</span>order_number<span class="token punctuation">,</span>
         ls_op                <span class="token keyword">TYPE</span> rcrop<span class="token punctuation">,</span>
         ls_vgw               <span class="token keyword">TYPE</span> rcrvgw<span class="token punctuation">,</span>
         ls_afvc              <span class="token keyword">TYPE</span> afvc<span class="token punctuation">,</span>
         ls_plpo              <span class="token keyword">TYPE</span> plpo<span class="token punctuation">,</span>
         lv_value_fix         <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">4</span><span class="token punctuation">,</span>
         lv_value_var         <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">4</span><span class="token punctuation">,</span>
         lv_value             <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">4</span><span class="token punctuation">,</span>
         lv_unit              <span class="token keyword">TYPE</span> rcrvgw<span class="token token-operator punctuation">-</span>vge01<span class="token punctuation">,</span>
         lv_output            <span class="token keyword">TYPE</span> p <span class="token keyword">DECIMALS</span> <span class="token number">3</span><span class="token punctuation">.</span>

  <span class="token keyword">FIELD-SYMBOLS</span><span class="token punctuation">:</span> &lt;fs_timetickets> <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> lt_timetickets<span class="token punctuation">.</span>

  <span class="token eol-comment comment">" create a log instance</span>
  <span class="token keyword">CREATE</span> <span class="token keyword">OBJECT</span> lo_logger
    <span class="token keyword">EXPORTING</span>
      iv_subobject <span class="token operator">=</span> <span class="token string">'ZPP_APP'</span><span class="token punctuation">.</span>
  lo_logger<span class="token token-operator punctuation">-></span>create_log<span class="token punctuation">(</span> <span class="token keyword">IMPORTING</span> ev_log_handle <span class="token operator">=</span> lv_log_handle <span class="token punctuation">)</span><span class="token punctuation">.</span>
  lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">'Begin Method PROCCONFIRMATION_GET_ENTITYSET.'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>

  <span class="token eol-comment comment">"get $filter through the io_tech request (odata request)</span>
  lt_filters <span class="token operator">=</span> io_tech_request_context<span class="token token-operator punctuation">-></span>get_filter<span class="token punctuation">(</span> <span class="token punctuation">)</span>->get_filter_select_options<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>

  <span class="token eol-comment comment">" Process filters</span>

  <span class="token eol-comment comment">" for these below we just need the singular select option structure</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'PLANT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_plant_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'ORDERID'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_orderid_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'FIN_CONF'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_fin_conf_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'DEV_REASON'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_dev_reason_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'CONF_TEXT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_conf_text_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'CONF_QUAN_UNIT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_conf_quan_unit_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'YIELD'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_yield_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'SCRAP'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_select_options <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_select_options <span class="token keyword">INTO</span> ls_scrap_so <span class="token keyword">INDEX</span> <span class="token number">1</span><span class="token punctuation">.</span>

  <span class="token eol-comment comment">" for the following we need tables (make a loop and get the values from each)</span>
  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'STGE_LOC'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_stg_loc <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'BATCH'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_batch <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'RESERV_NO'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_reserv_no <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'RES_ITEM'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_res_item <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'ENTRY_QNT'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_entry_qnt <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

  <span class="token keyword">CLEAR</span> ls_filters<span class="token punctuation">.</span>
  <span class="token keyword">READ</span> <span class="token keyword">TABLE</span> lt_filters <span class="token keyword">WITH</span> <span class="token keyword">TABLE</span> <span class="token keyword">KEY</span> <span class="token keyword">property</span> <span class="token operator">=</span> <span class="token string">'ENTRY_UOM'</span> <span class="token keyword">INTO</span> ls_filters<span class="token punctuation">.</span>
  lt_entry_uom <span class="token operator">=</span> ls_filters<span class="token token-operator punctuation">-</span>select_options<span class="token punctuation">.</span>

  <span class="token eol-comment comment">" Create goodsmovement structure for all the retroactive items</span>
  <span class="token keyword">DESCRIBE</span> <span class="token keyword">TABLE</span> lt_reserv_no <span class="token keyword">LINES</span> lv_reserv_lines<span class="token punctuation">.</span>
  <span class="token keyword">DO</span> lv_reserv_lines <span class="token keyword">TIMES</span><span class="token punctuation">.</span>
    ls_stg_loc <span class="token operator">=</span> lt_stg_loc[ lv_index ]<span class="token punctuation">.</span>
    ls_batch <span class="token operator">=</span> lt_batch[ lv_index ]<span class="token punctuation">.</span>
    ls_reserv_no <span class="token operator">=</span> lt_reserv_no[ lv_index ]<span class="token punctuation">.</span>
    ls_res_item <span class="token operator">=</span> lt_res_item[ lv_index ]<span class="token punctuation">.</span>
    ls_entry_qnt <span class="token operator">=</span> lt_entry_qnt[ lv_index ]<span class="token punctuation">.</span>
    ls_entry_uom <span class="token operator">=</span> lt_entry_uom[ lv_index ]<span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>plant <span class="token operator">=</span> ls_plant_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span> <span class="token eol-comment comment">" fixed factory</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>stge_loc <span class="token operator">=</span> ls_stg_loc<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>batch <span class="token operator">=</span> ls_batch<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>move_type <span class="token operator">=</span> <span class="token string">'261'</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" fixed movement type</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>item_text <span class="token operator">=</span> <span class="token string">'Warenbewegung für Rückmeldung PP APP'</span><span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>reserv_no <span class="token operator">=</span> ls_reserv_no<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>res_item <span class="token operator">=</span> ls_res_item<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>entry_qnt <span class="token operator">=</span> ls_entry_qnt<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_goodsmovements<span class="token token-operator punctuation">-</span>entry_uom <span class="token operator">=</span> ls_entry_uom<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    <span class="token keyword">APPEND</span> ls_goodsmovements <span class="token keyword">TO</span> lt_goodsmovements<span class="token punctuation">.</span>
    lv_index <span class="token operator">=</span> lv_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span>
  <span class="token keyword">ENDDO</span><span class="token punctuation">.</span>

  ls_order_objects<span class="token token-operator punctuation">-</span>phases <span class="token operator">=</span> <span class="token string">'X'</span><span class="token punctuation">.</span>
  lv_number <span class="token operator">=</span> ls_orderid_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>

  <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PROCORD_GET_DETAIL'</span>
    <span class="token keyword">EXPORTING</span>
      <span class="token keyword">number</span>        <span class="token operator">=</span> lv_number
<span class="token comment">*       COLLECTIVE_ORDER       =</span>
      order_objects <span class="token operator">=</span> ls_order_objects
<span class="token comment">*     IMPORTING</span>
<span class="token comment">*       RETURN        =</span>
    <span class="token keyword">TABLES</span>
<span class="token comment">*       HEADER        =</span>
<span class="token comment">*       POSITION      =</span>
<span class="token comment">*       SEQUENCE      =</span>
      phase         <span class="token operator">=</span> lt_phase
<span class="token comment">*       TRIGGER_POINT =</span>
<span class="token comment">*       COMPONENT     =</span>
<span class="token comment">*       PROD_REL_TOOL =</span>
    <span class="token punctuation">.</span>

  <span class="token keyword">LOOP</span> <span class="token keyword">AT</span> lt_phase <span class="token keyword">INTO</span> ls_phase<span class="token punctuation">.</span> <span class="token eol-comment comment">" for each phase - create both the activities table and timetickets table</span>
    <span class="token keyword">CLEAR</span> ls_timetickets<span class="token punctuation">.</span>

    <span class="token eol-comment comment">" this is the full key for table AFVC - Auftragsarbeitsvorgang for the routing number and counter - should always work with SELECT SINGLE</span>
    <span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> afvc <span class="token keyword">INTO</span> ls_afvc
      <span class="token keyword">WHERE</span> aufpl <span class="token operator">=</span> ls_phase<span class="token token-operator punctuation">-</span>routing_no
      <span class="token keyword">AND</span>   aplzl <span class="token operator">=</span> ls_phase<span class="token token-operator punctuation">-</span>counter<span class="token punctuation">.</span>

    <span class="token eol-comment comment">" this is the full key for table PLPO - Plan: Vorgang - so it should always work with SELECT SINGLE</span>
    <span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> plpo <span class="token keyword">INTO</span> ls_plpo
      <span class="token keyword">WHERE</span> plnty <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnty
      <span class="token keyword">AND</span> plnnr <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnnr
      <span class="token keyword">AND</span> plnkn <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>plnkn
      <span class="token keyword">AND</span> zaehl <span class="token keyword">EQ</span> ls_afvc<span class="token token-operator punctuation">-</span>zaehl<span class="token punctuation">.</span>

    <span class="token eol-comment comment">" now provide all the standard values (vorgabewert) VGW01, 02, etc into the calculation formula</span>
    <span class="token keyword">MOVE-CORRESPONDING</span> ls_plpo <span class="token keyword">TO</span> ls_op<span class="token punctuation">.</span>
    ls_op<span class="token token-operator punctuation">-</span>mgvrg <span class="token operator">=</span> ls_yield_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_op<span class="token token-operator punctuation">-</span>meinh <span class="token operator">=</span> ls_conf_quan_unit_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    <span class="token keyword">MOVE-CORRESPONDING</span> ls_plpo <span class="token keyword">TO</span> ls_vgw<span class="token punctuation">.</span>
    <span class="token keyword">DO</span> <span class="token number">6</span> <span class="token keyword">TIMES</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" for each activity (usually 4 activities here at company, but there can be up to 6 activities total)</span>
      <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">1</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw01 <span class="token keyword">EQ</span> <span class="token number">0</span>
      <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">2</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw02 <span class="token keyword">EQ</span> <span class="token number">0</span>
      <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">3</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw03 <span class="token keyword">EQ</span> <span class="token number">0</span>
      <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">4</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw04 <span class="token keyword">EQ</span> <span class="token number">0</span>
      <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">5</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw05 <span class="token keyword">EQ</span> <span class="token number">0</span>
      <span class="token keyword">OR</span> sy<span class="token token-operator punctuation">-</span>index <span class="token keyword">EQ</span> <span class="token number">6</span> <span class="token keyword">AND</span> ls_vgw<span class="token token-operator punctuation">-</span>vgw06 <span class="token keyword">EQ</span> <span class="token number">0</span><span class="token punctuation">.</span>
        <span class="token keyword">CONTINUE</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" skip and 0 values</span>
      <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>
      <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'CR_WORKCENTER_FORMULA_CALC'</span> <span class="token eol-comment comment">" You can see a SAP standard example with the function in the source code for transaction CR03 for costing formula: Program SAPLCRA0, Include LCRA0F71, Form FORMEL_RESULT_CALC, line 55</span>
        <span class="token keyword">EXPORTING</span>
          arbid             <span class="token operator">=</span> ls_afvc<span class="token token-operator punctuation">-</span>arbid
          op                <span class="token operator">=</span> ls_op
          vgw               <span class="token operator">=</span> ls_vgw
          <span class="token keyword">index</span>             <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>index
          <span class="token keyword">date</span>              <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datum
        <span class="token keyword">IMPORTING</span>
          value_fix         <span class="token operator">=</span> lv_value_fix
          value_var         <span class="token operator">=</span> lv_value_var
          <span class="token keyword">unit</span>              <span class="token operator">=</span> lv_unit
        <span class="token keyword">EXCEPTIONS</span>
          missing_parameter <span class="token operator">=</span> <span class="token number">1</span>
          not_found         <span class="token operator">=</span> <span class="token number">2</span>
          division_by_zero  <span class="token operator">=</span> <span class="token number">3</span>
          <span class="token keyword">OTHERS</span>            <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">.</span>
      <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
        <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
        <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
      <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>

      lv_value <span class="token operator">=</span> lv_value_fix <span class="token operator">+</span> lv_value_var<span class="token punctuation">.</span> <span class="token eol-comment comment">" total value is the sum of the fixed and varible values for this activity</span>

      <span class="token eol-comment comment">" Convert any </span><span class="token string">'H'</span> <span class="token keyword">values</span> <span class="token keyword">to</span> <span class="token string">'MIN'</span>
      <span class="token keyword">IF</span> lv_unit <span class="token keyword">NE</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'UNIT_CONVERSION_SIMPLE'</span>
          <span class="token keyword">EXPORTING</span>
            <span class="token keyword">input</span>                <span class="token operator">=</span> lv_value
            unit_in              <span class="token operator">=</span> lv_unit
            unit_out             <span class="token operator">=</span> <span class="token string">'MIN'</span>
          <span class="token keyword">IMPORTING</span>
            <span class="token keyword">output</span>               <span class="token operator">=</span> lv_output
          <span class="token keyword">EXCEPTIONS</span>
            conversion_not_found <span class="token operator">=</span> <span class="token number">1</span>
            division_by_zero     <span class="token operator">=</span> <span class="token number">2</span>
            input_invalid        <span class="token operator">=</span> <span class="token number">3</span>
            output_invalid       <span class="token operator">=</span> <span class="token number">4</span>
            <span class="token keyword">overflow</span>             <span class="token operator">=</span> <span class="token number">5</span>
            type_invalid         <span class="token operator">=</span> <span class="token number">6</span>
            units_missing        <span class="token operator">=</span> <span class="token number">7</span>
            unit_in_not_found    <span class="token operator">=</span> <span class="token number">8</span>
            unit_out_not_found   <span class="token operator">=</span> <span class="token number">9</span>
            <span class="token keyword">OTHERS</span>               <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>
        <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
          lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
          <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
          <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
        <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>
        lv_unit <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" 2018.04.19 - need to overwrite unit to MIN!</span>
      <span class="token keyword">ELSE</span><span class="token punctuation">.</span>
        lv_output <span class="token operator">=</span> lv_value<span class="token punctuation">.</span> <span class="token eol-comment comment">" copy over MIN value</span>
      <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>

      <span class="token keyword">CASE</span> sy<span class="token token-operator punctuation">-</span>index<span class="token punctuation">.</span>
        <span class="token keyword">WHEN</span> <span class="token number">1</span><span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity1  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit1 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">WHEN</span> <span class="token number">2</span><span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity2  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit2 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">WHEN</span> <span class="token number">3</span><span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity3  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit3 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">WHEN</span> <span class="token number">4</span><span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity4  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit4 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">WHEN</span> <span class="token number">5</span><span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity5  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit5 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
        <span class="token keyword">WHEN</span> <span class="token number">6</span><span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_activity6  <span class="token operator">=</span> lv_output<span class="token punctuation">.</span>
          ls_timetickets<span class="token token-operator punctuation">-</span>conf_acti_unit6 <span class="token operator">=</span> <span class="token string">'MIN'</span><span class="token punctuation">.</span>
      <span class="token keyword">ENDCASE</span><span class="token punctuation">.</span>
    <span class="token keyword">ENDDO</span><span class="token punctuation">.</span>

    <span class="token eol-comment comment">" Also build the table to confirm the operations (Vorgänge)</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_no    <span class="token operator">=</span> ls_phase<span class="token token-operator punctuation">-</span>conf_no<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>orderid    <span class="token operator">=</span> ls_orderid_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>phase      <span class="token operator">=</span> ls_phase<span class="token token-operator punctuation">-</span>operation_number<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>resource   <span class="token operator">=</span> ls_phase<span class="token token-operator punctuation">-</span>resource<span class="token punctuation">.</span> <span class="token eol-comment comment">" Resource in process orders is the equivalent of work_center (wrk_cntr) for production orders</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>plant      <span class="token operator">=</span> ls_plant_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>logdate    <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datlo<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>logtime    <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>timlo<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>postg_date <span class="token operator">=</span> sy<span class="token token-operator punctuation">-</span>datlo<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>yield <span class="token operator">=</span> ls_yield_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>scrap <span class="token operator">=</span> ls_scrap_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>fin_conf <span class="token operator">=</span> ls_fin_conf_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span> <span class="token eol-comment comment">" also overwrite the proposed tiel oder endruckmeldung - take what the user provides!</span>
    ls_timetickets<span class="token token-operator punctuation">-</span>conf_quan_unit <span class="token operator">=</span> ls_conf_quan_unit_so<span class="token token-operator punctuation">-</span>low<span class="token punctuation">.</span> <span class="token eol-comment comment">" Also the unit</span>
    <span class="token keyword">APPEND</span> ls_timetickets <span class="token keyword">TO</span> lt_timetickets<span class="token punctuation">.</span>
  <span class="token keyword">ENDLOOP</span><span class="token punctuation">.</span>

  <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_PROCORDCONF_CREATE_TT'</span>
<span class="token comment">*     EXPORTING</span>
<span class="token comment">*       POST_WRONG_ENTRIES             = '0'</span>
<span class="token comment">*       TESTRUN                        =</span>
    <span class="token keyword">IMPORTING</span>
      <span class="token keyword">return</span>         <span class="token operator">=</span> ls_return
    <span class="token keyword">TABLES</span>
      timetickets    <span class="token operator">=</span> lt_timetickets
      goodsmovements <span class="token operator">=</span> lt_goodsmovements
<span class="token comment">*       LINK_CONF_GOODSMOV             =</span>
<span class="token comment">*       CHARACTERISTICS_WIPBATCH       =</span>
<span class="token comment">*       LINK_CONF_CHAR_WIPBATCH        =</span>
<span class="token comment">*       CHARACTERISTICS_BATCH          =</span>
<span class="token comment">*       LINK_GM_CHAR_BATCH             =</span>
      detail_return  <span class="token operator">=</span> lt_detail_return
    <span class="token keyword">EXCEPTIONS</span>
      <span class="token keyword">OTHERS</span>         <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>
  <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subrc <span class="token operator">&lt;></span> <span class="token number">0</span><span class="token punctuation">.</span>
    lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
    <span class="token keyword">CONCATENATE</span> sy<span class="token token-operator punctuation">-</span>msgno sy<span class="token token-operator punctuation">-</span>msgid sy<span class="token token-operator punctuation">-</span>msgv1 sy<span class="token token-operator punctuation">-</span>msgv2 sy<span class="token token-operator punctuation">-</span>msgv3 sy<span class="token token-operator punctuation">-</span>msgv4 <span class="token keyword">INTO</span> es_entityset<span class="token token-operator punctuation">-</span>error_message<span class="token punctuation">.</span>
    <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
  <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>
  <span class="token keyword">IF</span> ls_return <span class="token keyword">IS</span> <span class="token keyword">NOT</span> <span class="token keyword">INITIAL</span><span class="token punctuation">.</span>
    <span class="token keyword">LOOP</span> <span class="token keyword">AT</span> lt_detail_return <span class="token keyword">INTO</span> ls_detail_return <span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token keyword">EQ</span> <span class="token string">'E'</span><span class="token punctuation">.</span>
      lv_error_message <span class="token operator">=</span> ls_detail_return<span class="token token-operator punctuation">-</span>message<span class="token punctuation">.</span>
    <span class="token keyword">ENDLOOP</span><span class="token punctuation">.</span>
    <span class="token keyword">CONCATENATE</span> <span class="token string">'Fehler bei der Rückmeldung: '</span> lv_error_message <span class="token keyword">INTO</span> lv_message<span class="token punctuation">.</span>
    lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> lv_message <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
    es_entityset<span class="token token-operator punctuation">-</span>error_message <span class="token operator">=</span> lv_error_message<span class="token punctuation">.</span>
    <span class="token keyword">APPEND</span> es_entityset <span class="token keyword">TO</span> et_entityset<span class="token punctuation">.</span>
  <span class="token keyword">ENDIF</span><span class="token punctuation">.</span>

  lo_logger<span class="token token-operator punctuation">-></span>create_message<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle iv_message <span class="token operator">=</span> <span class="token string">'Ende Method PROCCONFIRMATION_GET_ENTITYSET.'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token eol-comment comment">" add custom message to message log</span>
  lo_logger<span class="token token-operator punctuation">-></span>save_log<span class="token punctuation">(</span> <span class="token keyword">EXPORTING</span> iv_log_handle <span class="token operator">=</span> lv_log_handle <span class="token punctuation">)</span><span class="token punctuation">.</span>

  <span class="token eol-comment comment">" FB Documentation says COMMIT WORK is required</span>
  <span class="token keyword">CALL</span> <span class="token keyword">FUNCTION</span> <span class="token string">'BAPI_TRANSACTION_COMMIT'</span>
    <span class="token keyword">EXPORTING</span>
      <span class="token keyword">wait</span> <span class="token operator">=</span> <span class="token string">'X'</span><span class="token punctuation">.</span>
  <span class="token keyword">COMMIT</span> <span class="token keyword">WORK</span> <span class="token keyword">AND</span> <span class="token keyword">WAIT</span><span class="token punctuation">.</span></code></pre></div>
<h2>Final Comments</h2>
<p>Whew. Did it feel like a marathon? :runner: Because it felt to <em>me</em> like a marathon all that time I was scratching my head. I hope you all enjoyed and found this post useful for a not-so-often programmed function of this production planning section of SAP.</p>
<p>Another note and quick plug 😄 I hope everyone can appreciate the time I put into creating these posts (<em>hint:</em> posts this long take a <strong>LONG</strong> time to write!). It would make me happy and give me the motivation to keep writing these detailed ABAP posts if you’d consider donating (in the footer of any page on this blog) I have a <a href="https://www.paypal.me/chrisfrewin">PayPal.me link</a>, and I’m also an Ethereum developer if you’d like to donate Ether or if you would like to donate some RaiBlocks, as I am a RaiBlocks enthusiast if you would prefer to donate in that way.</p>
<p>💩 Ok, plug done! 💩</p>
<p>Cheers! 🍺</p>
<hr/>
<h1>Footnotes</h1>
<div id="footnote-1">
1. Activities/phases are for production orders; Operations are for process orders. From this point onward, I will refer just to activities, since this post focuses on production orders. I also post the adjacent code for process orders in this post.
</div>
<div id="footnote-2">
2. I have to give credit where credit is due! I received a lot of assistance from our production planning module supervisor - he showed me the transactions that finally got me to a working result. 👍
</div>
<div id="footnote-3">
3. You can set up your production planning (PP) module to give you a proposal amount for the activities, directly when you are doing confirmations transaction <span style="font-family:'Courier New'">CO11N</span>:
<p>Upon pressing ‘enter’ for with a new amount:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3185baf9a83949f8159892ccdb462ae1/5f978/co11n-1.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 38.04627249357326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdyCUH//xAAWEAEBAQAAAAAAAAAAAAAAAAAAISL/2gAIAQEAAQUCaV//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQEABj8CbGx//8QAGhAAAQUBAAAAAAAAAAAAAAAAAAERMWGR4f/aAAgBAQABPyFJG5C+B//aAAwDAQACAAMAAAAQf9//xAAWEQADAAAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QapD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8Qla//xAAdEAABBAIDAAAAAAAAAAAAAAABACExURFhgaHR/9oACAEBAAE/EMBCahUB5P2gQYk6L1f/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Automatic calculation of confirmation activities by the System in transaction CO11N"
        title="Automatic calculation of confirmation activities by the System in transaction CO11N"
        src="/static/3185baf9a83949f8159892ccdb462ae1/88218/co11n-1.jpg"
        srcset="/static/3185baf9a83949f8159892ccdb462ae1/7237a/co11n-1.jpg 148w,
/static/3185baf9a83949f8159892ccdb462ae1/0cfdf/co11n-1.jpg 295w,
/static/3185baf9a83949f8159892ccdb462ae1/88218/co11n-1.jpg 590w,
/static/3185baf9a83949f8159892ccdb462ae1/5f978/co11n-1.jpg 778w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Pressing ‘OK’ for this window, we get a popup:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/db1bc4d71c71cd1dfe6d33830158b2c6/ec99f/co11n-2.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50.42301184433165%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe3cWGj/xAAVEAEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAQABBQJj/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAgIDAAAAAAAAAAAAAAAAADEBIRBRcf/aAAgBAQABPyHo7L2MQsf/2gAMAwEAAgADAAAAELMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAMAAgMAAAAAAAAAAAAAAQARIRAxUXGR/9oACAEBAAE/ECsbHpsgFAyvJ8m6vQdTGOP/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Filling confirmation activities by hand in transaction CO11N"
        title="Filling confirmation activities by hand in transaction CO11N"
        src="/static/db1bc4d71c71cd1dfe6d33830158b2c6/88218/co11n-2.jpg"
        srcset="/static/db1bc4d71c71cd1dfe6d33830158b2c6/7237a/co11n-2.jpg 148w,
/static/db1bc4d71c71cd1dfe6d33830158b2c6/0cfdf/co11n-2.jpg 295w,
/static/db1bc4d71c71cd1dfe6d33830158b2c6/88218/co11n-2.jpg 590w,
/static/db1bc4d71c71cd1dfe6d33830158b2c6/ec99f/co11n-2.jpg 591w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>We see that the Labor time is provided here. It’s likely 30 min for a full 100 KG, since the system is proposing only 15 minutes for 50 KG, half of what the full order amount should be. (I know, it’s not a full four field example - but values would also be proposed if you had more fields like machine time, machine set-up, etc.)</p>
</div>
<div id="footnote-4">
4. Note: At my company, we usually use only up to four confirmation activities. Note that there can be up to six, but for this example, we'll say that the confirmation process has only a maximum of four.
</div>
<div id="footnote-5">
5. I ended up determining that you can exclude parameter `co_a` without any issues - however, this may be how the settings at my own company work - you can look deeper into the SAP example to include it.
</div>
<div id="footnote-6">
6. This issue does not affect the confirmation formulas, but rather the goods movements in the retrograde ingredients - specifically when the goods movements are to be overridden, for example with a batch split for a retrograde material, or a custom under- or over- amount of a retrograde material. For the rare case where an employee wanted to book some of our retrograde materials from various batch numbers and warehouse locations, they noticed in these custom goods movements with the confirmation were not being added; but rather always the default SAP-calculated amounts. After some head scratching, I found it all has to do with function module <span style="font-family:'Courier New'">BAPI_PRODORDCONF_CREATE_TT</span> (or <span style="font-family:'Courier New'">BAPI_PROCORDCONF_CREATE_TT</span> depending on your use case) - I was not passing in an important parameter which allows exactly this desired override behavior:
<pre>
LinkConfGoodsmov
The assignment of the goods movements to a confirmation is effected
via the LinkConfGoodsmov table. There must be an entry in this table
for every entry in the Goodsmovements table. The index in the
LinkConfGoodsmov-Index_Confirm field refers to the line of the
associated confirmation in the Timetickets table and the index in
the LinkConfGoodsmov-Index_Goodsmov field refers the associated
goods movement in the Goodsmovements table.
If you want to prevent a goods movement from being posted for a
confirmation according to the standard logic, make an entry in the
LinkConfGoodsmov table as well as in the Timetickets table. The
index in the LinkConfGoodsmov-Index_Confirm field refers to the line
of the associated confirmation in the Timetickets table. Enter the
initial value 0 in the LinkConfGoodsmov-Index_Goodsmov field. It is
not necessary to make an entry in the Goodsmovements table in this
case.
If there is no entry in the LinkConfGoodsmov table for a
confirmation, goods movements are determined for backflushing and
automatic goods receipt using the standard logic.
</pre>
<p>We needed to add the following too our goods movements loop (already added in the code above! 😄):</p>
<div class="gatsby-highlight" data-language="abap"><pre class="language-abap"><code class="language-abap">BLAH</code></pre></div>
</div></section><hr style="margin-bottom:1.625rem"/><footer><div style="display:flex;margin-bottom:4.0625rem;position:relative;z-index:10"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.8125rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAG3DY5430BJ8E1uDf/EABwQAQABBQEBAAAAAAAAAAAAAAECAAMSEyIQIf/aAAgBAQABBQLZ8t3c5dVN5trB30hIwHz/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREQ/9oACAEDAQE/AYiLf//EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8BpXv/xAAdEAACAgEFAAAAAAAAAAAAAAAAARAREiExMmGR/9oACAEBAAY/AuQ1bh0N4+M2NRdR/8QAGhABAQEAAwEAAAAAAAAAAAAAAREAMUFh8f/aAAgBAQABPyETXTzKAhyKaLtMhYD1dCnnimD96INM1E8ab//aAAwDAQACAAMAAAAQf99D/8QAFxEAAwEAAAAAAAAAAAAAAAAAAREgIf/aAAgBAwEBPxAK2D//xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAgEBPxBw/wD/xAAfEAEAAgIBBQEAAAAAAAAAAAABABEhMVFBYXGBkfD/2gAIAQEAAT8QfEUFctRs8MRA48wBb2jUtiJS0uJty9aSsq/txBdyKjahpjdlmDp8lOA9T//Z" alt="Chris Frewin" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/184fa5bf6a2882dd8fff63606854db72/30d3a/defaultprofilepicture.jpg 1x,
/static/184fa5bf6a2882dd8fff63606854db72/66c95/defaultprofilepicture.jpg 1.5x,
/static/184fa5bf6a2882dd8fff63606854db72/aacbd/defaultprofilepicture.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/184fa5bf6a2882dd8fff63606854db72/30d3a/defaultprofilepicture.jpg 1x,
/static/184fa5bf6a2882dd8fff63606854db72/66c95/defaultprofilepicture.jpg 1.5x,
/static/184fa5bf6a2882dd8fff63606854db72/aacbd/defaultprofilepicture.jpg 2x" src="/static/184fa5bf6a2882dd8fff63606854db72/30d3a/defaultprofilepicture.jpg" alt="Chris Frewin" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Hi, I&#x27;m <strong>Chris Frewin</strong>, I&#x27;m going to be COURSE MASTER for 2020 (I hope)!<sup><sup><sup>please help me</sup></sup></sup><br/><br/>I&#x27;m an ex-mechanical engineer gone full-remote, full-stack application software engineer, and a hobbyist machine learning/natural language processing developer.<!-- --> <br/><br/>If I&#x27;m not building software, I&#x27;ll be found hiking, skiing, taking pictures, spoiling homebrew, or creating music and art. I (mostly) live in Austria.<br/><br/><a href="https://instagram.com/_chrisfrewin_">You can follow me on Instagram.</a><br/><br/>or,<br/><br/><a href="mailto:frewin.christopher@gmail.com">Send me an email.</a><br/><br/><br/>I&#x27;m a proud member of the <a target="_blank" rel="noopener noreferrer" href="https://dev.to/frewinchristopher">DEV Community</a>, and <a target="_blank" rel="noopener noreferrer" href="https://producthunt.com/@galt_">Product Hunt&#x27;s Makers Community</a>!<br/><br/><span>Sites and products I&#x27;ve built solo or co-developed:</span><br/><br/><a href="https://rœst.com" target="_blank" rel="noopener noreferrer">rœst.com</a> / <a href="https://rœst.com" target="_blank" rel="noopener noreferrer">rœst.coffee</a> (Solo)<br/><a href="https://sirenapparel.us" target="_blank" rel="noopener noreferrer">sirenapparel.us</a> (Solo)<br/><a href="https://chrisfrew.in/nlp-champs" target="_blank" rel="noopener noreferrer">chrisfrew.in/nlp-champs (formerly nlp-champs.com)</a> (Solo)<br/><a href="https://seelengeflüster-tirol.com" target="_blank" rel="noopener noreferrer">seelengeflüster-tirol.com</a> (Solo)<br/><a href="https://wallstreetbetswally.github.io" target="_blank" rel="noopener noreferrer">wallstreetbetswally.github.io</a> (Solo)<br/><a href="https://chrisfrew.in/invaders" target="_blank" rel="noopener noreferrer">chrisfrew.in/invaders</a> (Solo)<br/><a href="https://chrisfrew.in/portfolio" target="_blank" rel="noopener noreferrer">chrisfrew.in/portfolio</a> (Solo)<br/><a href="https://risch-shoes.com" target="_blank" rel="noopener noreferrer">risch-shoes.com</a> (Co-Developed)<br/><a href="https://fullstackcraft.com" target="_blank" rel="noopener noreferrer">fullstackcraft.com</a> (Solo)</p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/debugging-abap-with-a-sap-shortcut/">← <!-- -->Debugging ABAP Code with a SAP Shortcut - A Must-Have Tool!</a></li><li><a rel="next" href="/colors-for-sap-web-ide/">Colors For SAP Web IDE!<!-- --> →</a></li></ul></nav></main><footer><h5>© <!-- -->2020<!-- --> <a href="https://fullstackcraft.com" target="_blank" rel="noopener noreferrer">Full Stack Craft</a><br/>Really like the blog? You can support it:<br/><br/><style>.bmc-button img{width: 27px !important;margin-bottom: 3px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-block !important;color:#000000 !important;background-color:#FFDD00 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 23px !important;letter-spacing: 0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#000000 !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"/><a class="bmc-button" target="_blank" rel="noopener noreferrer" href="https://www.buymeacoffee.com/chrisfrewin"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a cappucino"/><span style="margin-left:5px">Buy me a cappucino</span></a><br/></h5></footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-63301492-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/calculating-activity-amounts-for-process-and-production-orders-with-sap-abap/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-4c82f1120542748bc39c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-2642abeb110b544c12ef.js"],"component---src-pages-404-js":["/component---src-pages-404-js-bc3ba61736348bd57dc4.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c2d16f17a80f59aa5de1.js"]};/*]]>*/</script><script src="/webpack-runtime-36e88acb22a2e2ba2636.js" async=""></script><script src="/styles-5d031bf83756cf4dd9d4.js" async=""></script><script src="/app-4c82f1120542748bc39c.js" async=""></script><script src="/commons-7d19cfac33a62ab090eb.js" async=""></script><script src="/component---src-templates-blog-post-js-2642abeb110b544c12ef.js" async=""></script></body></html>