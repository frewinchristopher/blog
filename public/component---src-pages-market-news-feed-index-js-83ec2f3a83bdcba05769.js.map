{"version":3,"sources":["webpack:///./src/pages/market-news-feed/index.js","webpack:///./src/utils/typography.js"],"names":["socket","io","connect","MarketNews","_this","_React$Component","call","this","state","aListItems","setupNotifications","bind","_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_4___default","setupSocketEvents","Notification","permission","requestPermission","_this2","on","oNewsItem","_this2$setState","aItems","oDate","Date","iUnixDateTime","setState","sId","console","log","unshift","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","key","className","href","sLink","target","rel","sIdentifier","toLocaleString","sTitle","setTimeout","_this2$setState2","oStreamData","Audio","sBase64","play","render","react_helmet__WEBPACK_IMPORTED_MODULE_6___default","title","style","Object","assign","scale","display","marginBottom","rhythm","marginTop","componentDidMount","that","axios","get","then","response","data","forEach","iIndex","unix_time_released","push","id","link","identifier","length","catch","error","React","Component","__webpack_require__","d","__webpack_exports__","typography__WEBPACK_IMPORTED_MODULE_0__","typography__WEBPACK_IMPORTED_MODULE_0___default","n","typography_theme_wordpress_2016__WEBPACK_IMPORTED_MODULE_1__","typography_theme_wordpress_2016__WEBPACK_IMPORTED_MODULE_1___default","Wordpress2016","overrideThemeStyles","a.gatsby-resp-image-link","boxShadow","googleFonts","typography","Typography"],"mappings":"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","file":"component---src-pages-market-news-feed-index-js-83ec2f3a83bdcba05769.js","sourcesContent":["import React from 'react'\nimport Helmet from 'react-helmet'\nimport axios from 'axios'\nimport { rhythm, scale } from '../../utils/typography'\nimport io from 'socket.io-client'; // client side of socket\nconst sAPI_URL = 'https://chrisfrew.in/market-news-feed-api'; // path for http communication to port 9002\nconst sWS_URL = 'https://chrisfrew.in/market-news-feed-ws'; // path for websocket communication to port 9003\nconst socket = io.connect(sWS_URL); \n\nclass MarketNews extends React.Component {    \n    constructor() {\n      super();\n      this.state = {\n        aListItems: []\n      };\n      this.setupNotifications = this.setupNotifications.bind(this);\n      this.setupSocketEvents = this.setupSocketEvents.bind(this);\n    }\n    setupNotifications() {\n      // ask the user for permission\n      if (Notification.permission !== \"granted\") {\n        Notification.requestPermission();\n      }\n    }\n    setupSocketEvents() {\n      socket.on('newNews', (oNewsItem) => {\n        let aItems = this.state.aListItems;\n        let oDate = new Date(oNewsItem.iUnixDateTime*1000);\n        this.setState({ [oNewsItem.sId]: \"newNewsNotification\" });\n        console.log(oNewsItem);\n        aItems.unshift(<li key={oNewsItem.sId} className={this.state[oNewsItem.sId]}><a href={oNewsItem.sLink} target=\"_blank\" rel=\"noopener noreferrer\" className=\"newNewsNotification\">{oNewsItem.sIdentifier}, {oDate.toLocaleString()}: {oNewsItem.sTitle}</a></li>);\n        setTimeout(() => { this.setState({ [oNewsItem.sId]: \"\" }); }, 6000); // need to remove the animation class after it is done (5 seconds + 1 second buffer)\n        this.setState({aListItems: aItems});\n        if (Notification.permission === \"granted\") {\n          new Notification(\"Breaking news: for \" + oNewsItem.sIdentifier +  \":\\\"\" + oNewsItem.sTitle + \"\\\"\");\n        }\n      });\n      socket.on('mp3Data', (oStreamData) => {\n        let oAudio = new Audio(oStreamData.sBase64);\n        oAudio.play();\n      });\n    }\n    render() {\n      return (\n        <div>\n          <Helmet title=\"Market News Feed\" />\n          <h1>Market News Feed</h1>\n          <p\n            style={{\n              ...scale(-1 / 5),\n              display: 'block',\n              marginBottom: rhythm(1),\n              marginTop: rhythm(-1),\n            }}\n          >\n            A live stream of Finviz news, so you don't have to refresh. Notifications can be enabled.\n          </p>\n          <ul>\n            {this.state.aListItems}\n          </ul>\n        </div>\n      );\n    }\n    componentDidMount() {\n      this.setupNotifications();\n      this.setupSocketEvents();\n      let that = this;\n      axios.get(sAPI_URL)\n        .then(function (response) {\n          let aItems = [];\n          let oDate;\n          response.data.forEach((oNewsItem, iIndex) => {\n            oDate = new Date(oNewsItem.unix_time_released*1000);\n            aItems.push(<li key={oNewsItem.id}><a href={oNewsItem.link} target=\"_blank\" rel=\"noopener noreferrer\">{oNewsItem.identifier}, {oDate.toLocaleString()}: {oNewsItem.title}</a></li>);\n            if (iIndex + 1 === response.data.length) {\n              that.setState({aListItems: aItems});\n            }\n          });\n        })\n        .catch(function (error) {\n          that.setState({aListItems: [<li key=\"error\">Error loading feed :(</li>]});\n          console.log(error);\n        });\n    }\n}\n\nexport default MarketNews","import Typography from 'typography'\nimport Wordpress2016 from 'typography-theme-wordpress-2016'\n\nWordpress2016.overrideThemeStyles = () => ({\n  'a.gatsby-resp-image-link': {\n    boxShadow: 'none',\n  },\n})\n\ndelete Wordpress2016.googleFonts\n\nconst typography = new Typography(Wordpress2016)\n\n// Hot reload typography in development.\nif (process.env.NODE_ENV !== 'production') {\n  typography.injectStyles()\n}\n\nexport default typography\nexport const rhythm = typography.rhythm\nexport const scale = typography.scale"],"sourceRoot":""}